In this sample we are using Application Manager as the API Gateway and PIzzaShack web application
calling to some APIs that have been deployed on Application Manager and those APIs have secured
using oauth2. We are going to publish this PizzaShack web application through the AppManager and
retreive an accesss token from Application Manager by giving the SAML token generated from the
AppManager while the SSO authentication.


PRE-REQUESTIES
===============
1)WSO2 Application Server
2)WSO2 API Manager
3)WSO2 App Manager

INSTRUCTIONS
==============

1) In step 1 & 2, we are configuring the API Manager.
 Define following three APIs in the API Publisher app & push to API gateway. (will be deploying the actual service implementation from step 4 onwards)

   Delivery API

        API Name= pizzaShack
        Context = /pizzashack/delivery
        Version = 1.0.0
        Production Endpoint URL=http://localhost:9765/pizzashack-api-1.0.0/api/delivery
        API Resources =Keep the default values 

   Order API
        
        API Name= pizzashack-order
        Context = /pizzashack/order
        Version = 1.0.0
        Production Endpoint URL=http://localhost:9765/pizzashack-api-1.0.0/api/order
        API Resources =Keep the default values 

   Menu API

        API Name= pizzashack-menu
        Context = /pizzashack/menu
        Version = 1.0.0
        Production Endpoint URL=http://localhost:9765/pizzashack-api-1.0.0/api/menu
        API Resources =Keep the default values 
	

2) Subscribe to all three APIs through default application & generate production key.

3) In this step we are publishing the web application in App Manager. Provide the details of consumer/secret key generated from the API Manager in the step (2) and the token endpoint of the API Manager (http://localhost:8285/token assuming API Manager runs with offset 5) and alias name as "pizzashack" for API.

Once web-application is created on App Manager, goto the Overview page of the application, there you can see the consumer/secret key generated for web application in the AppManager.

4) Go to the AppManager store and subscribe to PizzaShack web application.

5) Replace the consumer key & secret generated in step 3) in /pizza-shack-web/src/main/webapp/WEB-INF/web.xml

6) The Server Url in  pizza-shack-web Web.xml to be to 8285 (assuming API Manager is running with port offset 5. Incase it uses a different port offset, give the Server Url accordingly).

   The Login Url in  pizza-shack-web Web.xml to be to 8280 (This need to point to the token API of App Manager.)

7) Go to the "wso2appm-1.0.0/samples/PizzaShack" directory and run maven to deploy the application.‘mvn clean install’ at the directory '/pizza-shack-web' and '/pizza-shack-api'

8) Deploy pizza-shack-web/target/pizzashack.war  & pizza-shack-api/target/pizzashack-api-1.0.0.war into App Server

9) App Server should run with port offset 2 .

10) Access the application through App Manager gateway @ http://localhost:8280/pizza

11) Login using admin/admin (or any user account you used for subscription). This will list all available Pizza menus by calling to the pizza-menu API published in API Manager. Access token is generated by passing the SAML token generated App Manager while SSO authentication.

